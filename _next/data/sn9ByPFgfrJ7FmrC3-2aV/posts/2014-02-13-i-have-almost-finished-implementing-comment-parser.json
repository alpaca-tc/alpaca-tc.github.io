{"pageProps":{"post":{"id":"2014-02-13-i-have-almost-finished-implementing-comment-parser","title":"Gemを書くときに知っておきたい3つの事","date":"2014-02-18 20:52","content":"<p>先日から書き続けていた<a href=\"https://github.com/alpaca-tc/comment_extractor\">CommentExtractor</a>が、大枠完成しました。</p>\n<img class=\"image_on_frame center\" src=\"/images/blog/i-have-almost-finished-implementing-comment-parser/capture.png\" alt=\"CommentExtractor\" />\n<p>さて、今回Gemを書くときに役に立った、便利なTipsを幾つか紹介します！</p>\n<!-- more -->\n<p>内容はバラバラです。笑</p>\n<ol>\n<li>READMEに視覚情報を追加する</li>\n<li>RubyGemsからGemを削除する</li>\n<li>RSpecをキレイに書く</li>\n</ol>\n<h2>1.READMEに視覚情報を追加する</h2>\n<p>READMEには視覚的なバッヂを追加出来ます。Gemを書くときには、ぜひとも入れておきたい情報ですね。</p>\n<ul>\n<li><a href=\"https://badge.fury.io/rb/comment_extractor\"><img src=\"https://badge.fury.io/rb/comment_extractor.png\" alt=\"Gem Version\"></a></li>\n<li><a href=\"https://travis-ci.org/alpaca-tc/comment_parser\"><img src=\"https://travis-ci.org/alpaca-tc/comment_extractor.png?branch=v1.0.0\" alt=\"Build Status\"></a></li>\n<li><a href=\"https://coveralls.io/r/alpaca-tc/comment_extractor?branch=v1.0.0\"><img src=\"https://coveralls.io/repos/alpaca-tc/comment_extractor/badge.png?branch=v1.0.0\" alt=\"Coverage Status\"></a></li>\n</ul>\n<p>もちろん、登録すれば無料で作ることが出来ます。</p>\n<p>詳しくは<a href=\"https://elgalu.github.io/2013/add-achievement-badges-to-your-gem-readme/\">コチラの記事</a>を読んでみましょう。</p>\n<h2>2.RubyGemsからGemを削除する</h2>\n<p>間違えてRubyGemsにPushしてしまった！</p>\n<p>そんなときに便利なyankコマンド。意外と知られていない。</p>\n<div class=\"remark-highlight\"><pre class=\"language-sh\"><code class=\"language-sh\">gem yank gem_name -v 1.0.0</code></pre></div>\n<p>ただ、これをやっても論理削除されるだけのようですねぇ。多分。</p>\n<p>このバージョン使うなよ！新しいの使えよ！ってときに使うコマンドだと思います。</p>\n<h2>3.RSpecをキレイに書く</h2>\n<p>RSpecをキレイに書く方法は、ある程度伝統があります。</p>\n<ul>\n<li><a href=\"https://betterspecs.org/\">BetterSpecs</a></li>\n<li><a href=\"https://bitfluxx.com/2011/05/23/some-rspec-tips-and-best-practices.html\">Some RSpec Tips and Best Practices</a></li>\n</ul>\n<p>今回は、ある程度RSpecを書ける人向けに、検索してもあまり出てこない情報(検索しにくい？)を提供したいと思います。</p>\n<h3>Syntaxについて</h3>\n<h4>be_truthy, be_falsy</h4>\n<p>RSpecが新しくなって、<code>be_true</code>, <code>be_false</code>→<code>be_truthy</code>, <code>be_falsy</code>となりました。\n今までは、厳密に<code>true</code>で無くてもテストが通っちゃいましたからね。</p>\n<h4>現在の主題であるクラスを取得する</h4>\n<p>RSpecでは<code>described_class</code>というメソッドを使用出来ます。\n<code>describe KlassName do...</code>で指定したKlassNameが格納されます。</p>\n<p>これを使えば、クラス名に依存せずにテストを書く事ができますね。</p>\n<h4>ExampleGroupを作る</h4>\n<p>ご存知の通り、Railsのテストではcontroller, model, viewで使えるメソッドが大きく異なります。\nそれは、RSpecのexample_groupという機能を使って、テストの種類を元にModuleをincludeしているからです。</p>\n<p>これを使えば、複数のファイルで共通する内容を簡単に記述する事が出来ます。\n次のような感じですね。</p>\n<div class=\"remark-highlight\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># spec_helper.rb</span>\n<span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>configure <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>config<span class=\"token operator\">|</span>\n  config<span class=\"token punctuation\">.</span><span class=\"token keyword\">include</span> <span class=\"token constant\">ExampleGroupModuleName</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">:</span> <span class=\"token symbol\">:optional</span><span class=\"token punctuation\">,</span> example_group<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    file_path<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Regexp</span><span class=\"token punctuation\">.</span>compile<span class=\"token punctuation\">(</span><span class=\"token string\">%w[spec comment_extractor extractor .*.rb]</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token string\">'[\\\\\\/]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>configure <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>config<span class=\"token operator\">|</span>\n  config<span class=\"token punctuation\">.</span>add_setting <span class=\"token symbol\">:source_code_path</span><span class=\"token punctuation\">,</span> default<span class=\"token punctuation\">:</span> <span class=\"token string\">'spec/assets/source_code'</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">module</span> <span class=\"token constant\">ExampleGroupModuleName</span>\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">source_code_path</span></span><span class=\"token punctuation\">(</span>file_name <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span>\n    dir <span class=\"token operator\">=</span> <span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span>source_code_path\n    file_name <span class=\"token operator\">?</span> <span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>dir<span class=\"token delimiter tag\">}</span></span>/<span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>file_name<span class=\"token delimiter tag\">}</span></span>\"</span> <span class=\"token punctuation\">:</span> dir\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">included</span></span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">)</span>\n    k<span class=\"token punctuation\">.</span>class_eval <span class=\"token keyword\">do</span>\n      let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:instance</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> described_class<span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>source_code<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n      let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:source_code</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> source_code_path<span class=\"token punctuation\">(</span>file_name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n      describe <span class=\"token string\">'.new'</span> <span class=\"token keyword\">do</span>\n        subject <span class=\"token punctuation\">{</span> instance <span class=\"token punctuation\">}</span>\n        let<span class=\"token punctuation\">(</span><span class=\"token symbol\">:file_name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">'filename.rb'</span> <span class=\"token punctuation\">}</span>\n        it <span class=\"token punctuation\">{</span> expect <span class=\"token punctuation\">{</span> subject <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>to_not raise_error <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n</code></pre></div>\n<p>これを使えば、まとまったテストをスッキリ書く事ができますね。</p>\n<h2>まとめ</h2>\n<p>ざっくばらんに書きました。\nGemを作るのは簡単なので、みなさんも作ってみてください！</p>\n<p>では！</p>"},"prevPost":{"id":"2014-04-10-apiary","title":"APIのMockサーバーを構築する「Apiary」を使ってみる","date":"2014-04-10 21:36"},"nextPost":{"id":"2014-02-12-how-to-use-star","title":"ここまで出来る！RubyのSplat Operatorまとめ","date":"2014-02-12 04:16"}},"__N_SSG":true}