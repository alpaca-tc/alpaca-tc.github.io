<!DOCTYPE html><html lang="ja"><head><title>Rubyのクラス変数について詰まったのでヘルプ - alpaca-tc</title><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="title" content="Rubyのクラス変数について詰まったのでヘルプ - alpaca-tc"/><meta name="description" content="基本的に、仕事でクラス変数を扱うことはほぼ無いです。今回は遊びのコードを書いていて、悩んだことをまとめました。&lt;!-- more --&gt; Rubyのクラス変数の扱いが難しい...。これ、結構Ruby書いている自分でも初めて遭遇して悩む問題だった。まず、次のような動くコードを書いてみた。```rubyclass Base"/><link rel="shortcut icon" href="/images/common/favicon.ico" type="image/x-icon"/><meta name="google-site-verification" content="thSL3cUT7BV1-AENglRFIF-kv6I85JJ6_iUGAU8GaQI"/><meta property="og:title" content="Rubyのクラス変数について詰まったのでヘルプ - alpaca-tc"/><meta property="og:locale" content="ja_JP"/><meta property="og:image" content="https://alpaca.tc/og-images/2013-12-16-ruby-class-variable.png"/><meta property="og:type" content="article"/><meta property="og:url" content="https://alpaca.tc/posts/2013-12-16-ruby-class-variable"/><meta property="og:site_name" content="alpaca-tc"/><meta property="og:description" content="基本的に、仕事でクラス変数を扱うことはほぼ無いです。今回は遊びのコードを書いていて、悩んだことをまとめました。&lt;!-- more --&gt; Rubyのクラス変数の扱いが難しい...。これ、結構Ruby書いている自分でも初めて遭遇して悩む問題だった。まず、次のような動くコードを書いてみた。```rubyclass Base"/><meta property="fb:app_id" content="224701561024840"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Rubyのクラス変数について詰まったのでヘルプ - alpaca-tc"/><meta name="twitter:description" content="基本的に、仕事でクラス変数を扱うことはほぼ無いです。今回は遊びのコードを書いていて、悩んだことをまとめました。&lt;!-- more --&gt; Rubyのクラス変数の扱いが難しい...。これ、結構Ruby書いている自分でも初めて遭遇して悩む問題だった。まず、次のような動くコードを書いてみた。```rubyclass Base"/><meta name="twitter:image" content="https://alpaca.tc/og-images/2013-12-16-ruby-class-variable.png"/><meta name="twitter:site" content="@alpaca_tc"/><meta name="twitter:creator" content="@alpaca_tc"/><meta name="next-head-count" content="21"/><link rel="preload" href="/_next/static/css/22e883b2b0207ea8.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/22e883b2b0207ea8.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-fda0a023b274c574.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-a2135738c9ea5908.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-e70807e0fdddea74.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/81c13e3d-c79994179d926ed0.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/569-78aba7d9db106112.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/65-6ac84ffe825df8b5.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-0ae89c3b9902c0dc.js" defer="" crossorigin=""></script><script src="/_next/static/xK4if3BVxxBdtwqPXEvjc/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/xK4if3BVxxBdtwqPXEvjc/_ssgManifest.js" defer="" crossorigin=""></script></head><body class="font-sans text-black leading-tight antialiased"><div id="__next"><div class="py-8 lg:py-16 px-6 md:px-16 lg:px-24 "><div class="relative z-20 flex justify-between items-center"><div class="flex lg:flex md:block items-center max-w-full"><div class="mb-0 md:mb-4 lg:mb-0 flex flex-shrink-0 pr-4 md:pr-6 lg:pr-12"><a href="/"><div class="inline-block h-10 w-10 md:h-12 md:w-12 lg:h-20 lg:w-20"><span class="flex items-center no-underline"><img class="rounded-full" alt="プロフィール画像" src="/images/profile.jpg" width="100%" height="100%"/></span></div></a></div><div><a class="block text-black no-underline font-bold text-xl lg:text-3xl font-extrabold leading-none lg:leading-tight" href="/">alpaca-tc</a><div class="hidden md:flex mt-3 lg:mt-4 uppercase tracking-wide text-xs space-x-6"><a class="text-black font-semibold no-underline hover:text-black text-gray-500 font-semibold no-underline hover:text-black" href="/">Posts</a><a class="text-gray-500 font-semibold no-underline hover:text-black" href="/about_me">About Me</a><a class="text-gray-500 font-semibold no-underline hover:text-black" href="/works">Works</a><a href="https://github.com/alpaca-tc" class="text-gray-500 font-semibold no-underline hover:text-black" target="_blank" rel="noreferrer">GitHub</a><a href="https://twitter.com/alpaca_tc" class="text-gray-500 font-semibold no-underline hover:text-black" target="_blank" rel="noreferrer">Twitter</a></div></div></div><div class="block md:hidden"><button class="block"><svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="text-black h-6 w-6 block"><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg><svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="text-black h-6 w-6 hidden"><path d="M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"></path></svg></button></div></div><div class="md:hidden z-10 bg-white fixed pt-24 pin block hidden"><div class="space-y-8 overflow-y-auto pt-6 pb-8 px-12 max-h-full overflow-y-auto"><a class="block text-black font-bold no-underline" href="/">Posts</a><a class="block text-black font-bold no-underline" href="/about_me">About Me</a><a class="block text-black font-bold no-underline" href="/works">Works</a><a href="https://github.com/alpaca-tc" class="block text-black font-bold no-underline" target="_blank" rel="noreferrer">GitHub</a><a href="https://twitter.com/alpaca_tc" class="block text-black font-bold no-underline" target="_blank" rel="noreferrer">Twitter</a></div></div><div class="lg:pl-32 mt-12"><article class="max-w-3xl md:mt-6 rounded-xl mx-auto bg-white dark:bg-cool-gray-800"><div class="text-grey-dark uppercase font-semibold text-xs tracking-wide">2013-12-16</div><h1 class="text-2xl font-extrabold text-black leading-tight mt-1 mb-6">Rubyのクラス変数について詰まったのでヘルプ</h1><div class="prose max-w-3xl mx-auto dark:text-cool-gray-100"><p>基本的に、仕事でクラス変数を扱うことはほぼ無いです。</p>
<p>今回は遊びのコードを書いていて、悩んだことをまとめました。</p>
<!-- more -->
<h1>Rubyのクラス変数の扱いが難しい...。</h1>
<p>これ、結構Ruby書いている自分でも初めて遭遇して悩む問題だった。</p>
<p>まず、次のような動くコードを書いてみた。</p>
<div class="remark-highlight"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">;</span> <span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token operator">&#x3C;</span> Base
  <span class="token variable">@@val</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'Node'</span></span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Branch</span> <span class="token operator">&#x3C;</span> Base
  <span class="token variable">@@val</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'Branch'</span></span>
<span class="token keyword">end</span>

p Node<span class="token punctuation">.</span>class_variable_get<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'@@val'</span></span><span class="token punctuation">)</span> <span class="token comment">#=> 'Node'</span>
p Branch<span class="token punctuation">.</span>class_variable_get<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'@@val'</span></span><span class="token punctuation">)</span> <span class="token comment">#=> 'Branch'</span>
</code></pre></div>
<p>ふむ、それぞれの派生クラスでクラス変数が使えますね。</p>
<p>では、続いて基底クラスにもクラス変数を与えてみる。</p>
<div class="remark-highlight"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Base</span>
  <span class="token variable">@@val</span> <span class="token operator">=</span> <span class="token keyword">nil</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token operator">&#x3C;</span> Base
  <span class="token variable">@@val</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'Node'</span></span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Branch</span> <span class="token operator">&#x3C;</span> Base
  <span class="token variable">@@val</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'Branch'</span></span>
<span class="token keyword">end</span>

p Node<span class="token punctuation">.</span>class_variable_get<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'@@val'</span></span><span class="token punctuation">)</span> <span class="token comment">#=> 'Branch'</span>
p Branch<span class="token punctuation">.</span>class_variable_get<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'@@val'</span></span><span class="token punctuation">)</span> <span class="token comment">#=> 'Branch'</span>
</code></pre></div>
<p>Ooops!!! 派性クラス内のクラス変数が、基底クラス変数を参照しよる！！</p>
<h2>解決編</h2>
<p>やりたいことは、派生クラスの子クラスに共通の変数を持たせるということ。</p>
<p>うーん、意外と難しい！</p>
<p>どうもクラス変数という感じではなくなるけれど、こうするしかないのだろうか...。</p>
<p>メソッドにしてみたら、とっても気持ちが悪い。</p>
<div class="remark-highlight"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Base</span>
  <span class="token keyword">class</span> <span class="token operator">&#x3C;&#x3C;</span> <span class="token keyword">self</span>
    <span class="token keyword">private</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">val</span></span>
      <span class="token string-literal"><span class="token string">'Base'</span></span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token operator">&#x3C;</span> Base
  <span class="token keyword">class</span> <span class="token operator">&#x3C;&#x3C;</span> <span class="token keyword">self</span>
    <span class="token keyword">private</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">val</span></span>
      <span class="token string-literal"><span class="token string">'Node'</span></span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Branch</span> <span class="token operator">&#x3C;</span> Base
  <span class="token keyword">class</span> <span class="token operator">&#x3C;&#x3C;</span> <span class="token keyword">self</span>
    <span class="token keyword">private</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">val</span></span>
      <span class="token string-literal"><span class="token string">'Branch'</span></span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

p Node<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token symbol">:val</span><span class="token punctuation">)</span> <span class="token comment">#=> 'Node'</span>
p Branch<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token symbol">:val</span><span class="token punctuation">)</span> <span class="token comment">#=> 'Branch'</span>
</code></pre></div>
<p>これだと、一応コードとして動く。 ただ、<strong>これは無いだろ感</strong>あるよね。</p>
<p>しかし、クラスインスタンス変数だと継承されないし、こうするしかないのかなぁ。</p>
<p><strong>だれか正しい方法があれば、教えてください！</strong> >_&#x3C;</p>
<h3>追記</h3>
<p>思いついたんだけど、継承するときにクラスインスタンス変数を渡せばいいのかな？</p>
<p>どうでしょう。</p>
<div class="remark-highlight"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Base</span>
  <span class="token variable">@val</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'Base'</span></span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">inherited</span></span><span class="token punctuation">(</span>klass<span class="token punctuation">)</span>
    klass<span class="token punctuation">.</span>instance_variable_set<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'@val'</span></span><span class="token punctuation">,</span> <span class="token variable">@val</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token operator">&#x3C;</span> Base<span class="token punctuation">;</span> <span class="token keyword">end</span>
<span class="token keyword">class</span> <span class="token class-name">Branch</span> <span class="token operator">&#x3C;</span> Base<span class="token punctuation">;</span> <span class="token keyword">end</span>

p Node<span class="token punctuation">.</span>instance_variable_get<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'@val'</span></span><span class="token punctuation">)</span> <span class="token comment">#=> 'Base'</span>
p Branch<span class="token punctuation">.</span>instance_variable_get<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'@val'</span></span><span class="token punctuation">)</span> <span class="token comment">#=> 'Base'</span>
</code></pre></div></div><div class="flex justify-end mt-4 h-10 bg"><a href="https://twitter.com/share?url=https%3A%2F%2Falpaca.tc%2Fposts%2F2013-12-16-ruby-class-variable&amp;text=Ruby%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9%E5%A4%89%E6%95%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%A9%B0%E3%81%BE%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A7%E3%83%98%E3%83%AB%E3%83%97+%7C+" data-url="" data-via="" data-width="120" data-counturl="" rel="nofollow noopener noreferrer" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter h-7 text-gray-400 hover:text-black transition duration-300 cursor-pointer" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://www.facebook.com/share.php?u=https%3A%2F%2Falpaca.tc%2Fposts%2F2013-12-16-ruby-class-variable" class="ml-4" data-url="" data-via="" data-width="120" data-counturl="" rel="nofollow noopener noreferrer" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook h-7 text-gray-400 hover:text-black transition duration-300 cursor-pointer" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256C0 376 82.7 476.8 194.2 504.5V334.2H141.4V256h52.8V222.3c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287V510.1C413.8 494.8 512 386.9 512 256h0z"></path></svg></a></div></article><aside class="max-w-3xl md:mt-6 mx-auto bg-white"><div class="border-solid border-t-1 border-b-1 border-gray-900"><a class="block lg:flex-half text-gray-600 transition duration-300 hover:text-gray-900 mt-1 mb-1 pt-4 pb-4 border border-solid border-l-0 border-r-0 border-b-0" href="/posts/2013-12-17-how-to-use-vim-unite-giti"><div><span class="block text-gray-500 uppercase font-semibold text-xs tracking-wide mb-2 no-underline">前の記事</span><span class="block text-gray-500 uppercase text-xs tracking-wide no-underline">2013-12-17</span><div class="underline">仕事が捗る！VimからGitを使う最適解</div></div></a><a class="block lg:flex-half text-gray-700 transition duration-300 hover:text-gray-900 mt-1 mb-1 pt-4 pb-4 border border-solid border-l-0 border-r-0 border-b-0" href="/posts/2013-12-13-using-vim-unite-watson"><div><span class="block text-gray-500 uppercase font-semibold text-xs tracking-wide mb-2 no-underline">次の記事</span><span class="block text-gray-500 uppercase text-xs tracking-wide no-underline">2013-12-13</span><div class="underline">Unite.vimとwatsonを使ったワークフロー</div></div></a></div></aside></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"id":"2013-12-16-ruby-class-variable","title":"Rubyのクラス変数について詰まったのでヘルプ","date":"2013-12-16 01:10","content":"\u003cp\u003e基本的に、仕事でクラス変数を扱うことはほぼ無いです。\u003c/p\u003e\n\u003cp\u003e今回は遊びのコードを書いていて、悩んだことをまとめました。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch1\u003eRubyのクラス変数の扱いが難しい...。\u003c/h1\u003e\n\u003cp\u003eこれ、結構Ruby書いている自分でも初めて遭遇して悩む問題だった。\u003c/p\u003e\n\u003cp\u003eまず、次のような動くコードを書いてみた。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-ruby\"\u003e\u003ccode class=\"language-ruby\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBase\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eNode\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e Base\n  \u003cspan class=\"token variable\"\u003e@@val\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'Node'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBranch\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e Base\n  \u003cspan class=\"token variable\"\u003e@@val\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'Branch'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\np Node\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclass_variable_get\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'@@val'\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#=\u003e 'Node'\u003c/span\u003e\np Branch\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclass_variable_get\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'@@val'\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#=\u003e 'Branch'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eふむ、それぞれの派生クラスでクラス変数が使えますね。\u003c/p\u003e\n\u003cp\u003eでは、続いて基底クラスにもクラス変数を与えてみる。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-ruby\"\u003e\u003ccode class=\"language-ruby\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBase\u003c/span\u003e\n  \u003cspan class=\"token variable\"\u003e@@val\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enil\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eNode\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e Base\n  \u003cspan class=\"token variable\"\u003e@@val\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'Node'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBranch\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e Base\n  \u003cspan class=\"token variable\"\u003e@@val\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'Branch'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\np Node\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclass_variable_get\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'@@val'\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#=\u003e 'Branch'\u003c/span\u003e\np Branch\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclass_variable_get\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'@@val'\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#=\u003e 'Branch'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOoops!!! 派性クラス内のクラス変数が、基底クラス変数を参照しよる！！\u003c/p\u003e\n\u003ch2\u003e解決編\u003c/h2\u003e\n\u003cp\u003eやりたいことは、派生クラスの子クラスに共通の変数を持たせるということ。\u003c/p\u003e\n\u003cp\u003eうーん、意外と難しい！\u003c/p\u003e\n\u003cp\u003eどうもクラス変数という感じではなくなるけれど、こうするしかないのだろうか...。\u003c/p\u003e\n\u003cp\u003eメソッドにしてみたら、とっても気持ちが悪い。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-ruby\"\u003e\u003ccode class=\"language-ruby\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBase\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u0026#x3C;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token method-definition\"\u003e\u003cspan class=\"token function\"\u003eval\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'Base'\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eNode\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e Base\n  \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u0026#x3C;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token method-definition\"\u003e\u003cspan class=\"token function\"\u003eval\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'Node'\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBranch\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e Base\n  \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u0026#x3C;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token method-definition\"\u003e\u003cspan class=\"token function\"\u003eval\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'Branch'\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\np Node\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token symbol\"\u003e:val\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#=\u003e 'Node'\u003c/span\u003e\np Branch\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token symbol\"\u003e:val\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#=\u003e 'Branch'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eこれだと、一応コードとして動く。 ただ、\u003cstrong\u003eこれは無いだろ感\u003c/strong\u003eあるよね。\u003c/p\u003e\n\u003cp\u003eしかし、クラスインスタンス変数だと継承されないし、こうするしかないのかなぁ。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eだれか正しい方法があれば、教えてください！\u003c/strong\u003e \u003e_\u0026#x3C;\u003c/p\u003e\n\u003ch3\u003e追記\u003c/h3\u003e\n\u003cp\u003e思いついたんだけど、継承するときにクラスインスタンス変数を渡せばいいのかな？\u003c/p\u003e\n\u003cp\u003eどうでしょう。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-ruby\"\u003e\u003ccode class=\"language-ruby\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBase\u003c/span\u003e\n  \u003cspan class=\"token variable\"\u003e@val\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'Base'\u003c/span\u003e\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token method-definition\"\u003e\u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003einherited\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eklass\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    klass\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einstance_variable_set\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'@val'\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e@val\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eNode\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e Base\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBranch\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e Base\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\np Node\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einstance_variable_get\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'@val'\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#=\u003e 'Base'\u003c/span\u003e\np Branch\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einstance_variable_get\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e'@val'\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#=\u003e 'Base'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","rawContent":"\n基本的に、仕事でクラス変数を扱うことはほぼ無いです。\n\n今回は遊びのコードを書いていて、悩んだことをまとめました。\n\n\u003c!-- more --\u003e\n\n# Rubyのクラス変数の扱いが難しい...。\n\nこれ、結構Ruby書いている自分でも初めて遭遇して悩む問題だった。\n\nまず、次のような動くコードを書いてみた。\n\n```ruby\nclass Base; end\n\nclass Node \u003c Base\n  @@val = 'Node'\nend\n\nclass Branch \u003c Base\n  @@val = 'Branch'\nend\n\np Node.class_variable_get('@@val') #=\u003e 'Node'\np Branch.class_variable_get('@@val') #=\u003e 'Branch'\n```\n\nふむ、それぞれの派生クラスでクラス変数が使えますね。\n\nでは、続いて基底クラスにもクラス変数を与えてみる。\n\n```ruby\nclass Base\n  @@val = nil\nend\n\nclass Node \u003c Base\n  @@val = 'Node'\nend\n\nclass Branch \u003c Base\n  @@val = 'Branch'\nend\n\np Node.class_variable_get('@@val') #=\u003e 'Branch'\np Branch.class_variable_get('@@val') #=\u003e 'Branch'\n```\n\nOoops!!! 派性クラス内のクラス変数が、基底クラス変数を参照しよる！！\n\n## 解決編\n\nやりたいことは、派生クラスの子クラスに共通の変数を持たせるということ。\n\nうーん、意外と難しい！\n\nどうもクラス変数という感じではなくなるけれど、こうするしかないのだろうか...。\n\nメソッドにしてみたら、とっても気持ちが悪い。\n\n```ruby\nclass Base\n  class \u003c\u003c self\n    private\n\n    def val\n      'Base'\n    end\n  end\nend\n\nclass Node \u003c Base\n  class \u003c\u003c self\n    private\n\n    def val\n      'Node'\n    end\n  end\nend\n\nclass Branch \u003c Base\n  class \u003c\u003c self\n    private\n\n    def val\n      'Branch'\n    end\n  end\nend\n\np Node.send(:val) #=\u003e 'Node'\np Branch.send(:val) #=\u003e 'Branch'\n```\n\nこれだと、一応コードとして動く。 ただ、**これは無いだろ感**あるよね。\n\nしかし、クラスインスタンス変数だと継承されないし、こうするしかないのかなぁ。\n\n**だれか正しい方法があれば、教えてください！** \u003e_\u003c\n\n### 追記\n\n思いついたんだけど、継承するときにクラスインスタンス変数を渡せばいいのかな？\n\nどうでしょう。\n\n```ruby\nclass Base\n  @val = 'Base'\n\n  def self.inherited(klass)\n    klass.instance_variable_set('@val', @val)\n  end\nend\n\nclass Node \u003c Base; end\nclass Branch \u003c Base; end\n\np Node.instance_variable_get('@val') #=\u003e 'Base'\np Branch.instance_variable_get('@val') #=\u003e 'Base'\n```\n"},"prevPost":{"id":"2013-12-17-how-to-use-vim-unite-giti","title":"仕事が捗る！VimからGitを使う最適解","date":"2013-12-17 23:36"},"nextPost":{"id":"2013-12-13-using-vim-unite-watson","title":"Unite.vimとwatsonを使ったワークフロー","date":"2013-12-13 02:29"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"2013-12-16-ruby-class-variable"},"buildId":"xK4if3BVxxBdtwqPXEvjc","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>